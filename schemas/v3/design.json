{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://raw.githubusercontent.com/shanberg/design/main/schemas/v3/design.json",
  "title": "Design Definition",
  "description": "A schema for defining designs.",
  "type": "object",
  "properties": {
    "schemaVersion": {
      "description": "The version of the design.json schema.",
      "type": "string",
      "enum": [
        "3.0.0"
      ],
      "default": "3.0.0"
    },
    "designType": {
      "description": "Whether this is a physical or digital design.",
      "$ref": "#/$defs/designTypeEnum"
    },
    "designInfo": {
      "$ref": "#/$defs/designInfo"
    },
    "specifications": {
      "$ref": "#/$defs/specifications"
    },
    "files": {
      "description": "A dictionary of all file items, where each key is a unique file ID.",
      "$ref": "#/$defs/filesCollection"
    },
    "previews": {
      "description": "An ordered list of previews for showcasing the design.",
      "type": "array",
      "items": {
        "$ref": "#/$defs/previewItem"
      }
    },
    "tags": {
      "type": "array",
      "items": {
        "type": "string"
      },
      "description": "A list of keywords for search and discovery."
    },
    "links": {
      "description": "External links related to the design project.",
      "$ref": "#/$defs/linksCollection"
    },
    "layout": {
      "$ref": "#/$defs/layout"
    }
  },
  "required": [
    "schemaVersion",
    "designType",
    "designInfo",
    "specifications",
    "files",
    "previews",
    "layout"
  ],
  "$defs": {
    "designTypeEnum": {
      "type": "string",
      "description": "Type of design - physical for print/tangible items, digital for screen-based content",
      "enum": [
        "physical",
        "digital"
      ]
    },
    "fileCategoryEnum": {
      "type": "string",
      "enum": [
        "previews",
        "workingFiles",
        "deliverables",
        "results",
        "otherFiles"
      ],
      "description": "Categories for organizing files within a design project"
    },
    "unitsEnum": {
      "type": "string",
      "enum": [
        "inch",
        "mm",
        "cm",
        "pt"
      ],
      "description": "Units of measurement for physical dimensions"
    },
    "physicalSubtypeEnum": {
      "type": "string",
      "enum": [
        "postcard",
        "business-card",
        "banner",
        "sign",
        "conference-booth",
        "packaging",
        "booklet",
        "handout",
        "poster"
      ]
    },
    "digitalSubtypeEnum": {
      "type": "string",
      "enum": [
        "presentation",
        "ad",
        "website",
        "ebook",
        "video",
        "social-media",
        "email"
      ]
    },
    "finishEnum": {
      "type": "string",
      "enum": [
        "gloss",
        "semi-gloss",
        "matte"
      ]
    },
    "designInfo": {
      "type": "object",
      "description": "Administrative metadata for the design.",
      "properties": {
        "title": {
          "type": "string",
          "description": "Human-readable title of the design"
        },
        "projectName": {
          "type": "string",
          "description": "Internal project name or identifier"
        },
        "version": {
          "type": "string",
          "description": "Version identifier for this design iteration"
        },
        "dateCreated": {
          "type": "string",
          "format": "date-time",
          "description": "ISO 8601 datetime with timezone"
        },
        "dateModified": {
          "type": "string",
          "format": "date-time",
          "description": "ISO 8601 datetime with timezone"
        }
      },
      "required": [
        "title",
        "dateCreated"
      ]
    },
    "specifications": {
      "type": "object",
      "oneOf": [
        {
          "$ref": "#/$defs/physicalSpecifications"
        },
        {
          "$ref": "#/$defs/digitalSpecifications"
        }
      ]
    },
    "physicalSpecifications": {
      "type": "object",
      "properties": {
        "width": {
          "type": "number",
          "exclusiveMinimum": 0
        },
        "height": {
          "type": "number",
          "exclusiveMinimum": 0
        },
        "units": {
          "$ref": "#/$defs/unitsEnum"
        },
        "subtype": {
          "$ref": "#/$defs/physicalSubtypeEnum"
        },
        "thickness": {
          "type": "number",
          "exclusiveMinimum": 0
        },
        "finish": {
          "$ref": "#/$defs/finishEnum"
        },
        "bleed": {
          "type": "number",
          "default": 0
        }
      },
      "required": [
        "width",
        "height",
        "units"
      ]
    },
    "digitalSpecifications": {
      "type": "object",
      "properties": {
        "width": {
          "type": "integer",
          "exclusiveMinimum": 0
        },
        "height": {
          "type": "integer",
          "exclusiveMinimum": 0
        },
        "subtype": {
          "$ref": "#/$defs/digitalSubtypeEnum"
        },
        "resolution": {
          "type": "number",
          "exclusiveMinimum": 0
        }
      },
      "required": [
        "width",
        "height"
      ]
    },
    "singleFileItem": {
      "type": "object",
      "properties": {
        "type": {
          "const": "single",
          "description": "Discriminator for a single file."
        },
        "path": {
          "type": "string",
          "pattern": "^(?!.*\\.\\.).*$",
          "minLength": 1
        },
        "description": {
          "type": "string"
        },
        "category": {
          "$ref": "#/$defs/fileCategoryEnum"
        }
      },
      "required": [
        "type",
        "path",
        "category"
      ]
    },
    "fileRangeItem": {
      "type": "object",
      "properties": {
        "type": {
          "const": "range",
          "description": "Discriminator for a file range."
        },
        "basePath": {
          "type": "string",
          "pattern": "^(?!.*\\.\\.).*$",
          "minLength": 1
        },
        "startNumber": {
          "type": "integer",
          "minimum": 1
        },
        "endNumber": {
          "type": "integer",
          "minimum": 1
        },
        "numberFormat": {
          "type": "string",
          "enum": [
            "1",
            "01",
            "001",
            "0001"
          ],
          "default": "01"
        },
        "fileExtension": {
          "type": "string",
          "pattern": "^\\.[a-zA-Z0-9]+$"
        },
        "description": {
          "type": "string"
        },
        "category": {
          "$ref": "#/$defs/fileCategoryEnum"
        }
      },
      "required": [
        "type",
        "basePath",
        "startNumber",
        "endNumber",
        "fileExtension",
        "category"
      ]
    },
    "fileItem": {
      "oneOf": [
        {
          "$ref": "#/$defs/singleFileItem"
        },
        {
          "$ref": "#/$defs/fileRangeItem"
        }
      ],
      "discriminator": {
        "propertyName": "type"
      }
    },
    "filesCollection": {
      "type": "object",
      "description": "A dictionary of all file items, where each key is a unique file ID.",
      "minProperties": 1,
      "additionalProperties": {
        "$ref": "#/$defs/fileItem"
      }
    },
    "previewItem": {
      "description": "A displayable preview, referencing a file.",
      "discriminator": {
        "propertyName": "type"
      },
      "oneOf": [
        {
          "$ref": "#/$defs/imagePreview"
        },
        {
          "$ref": "#/$defs/videoPreview"
        },
        {
          "$ref": "#/$defs/modelPreview"
        }
      ],
      "required": [
        "type",
        "fileKey"
      ]
    },
    "imagePreview": {
      "properties": {
        "type": {
          "const": "image"
        },
        "fileKey": {
          "type": "string"
        },
        "isPrimary": {
          "type": "boolean",
          "default": false
        }
      }
    },
    "videoPreview": {
      "properties": {
        "type": {
          "const": "video"
        },
        "fileKey": {
          "type": "string"
        }
      }
    },
    "modelPreview": {
      "properties": {
        "type": {
          "const": "model"
        },
        "fileKey": {
          "type": "string"
        }
      }
    },
    "linkReference": {
      "type": "object",
      "properties": {
        "id": {
          "type": "string",
          "pattern": "^[a-zA-Z0-9_-]+$"
        },
        "url": {
          "type": "string",
          "format": "uri"
        },
        "description": {
          "type": "string"
        },
        "linkType": {
          "type": "string"
        }
      },
      "required": [
        "id",
        "url"
      ]
    },
    "linksCollection": {
      "type": "object",
      "properties": {
        "links": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/linkReference"
          }
        }
      },
      "required": [
        "links"
      ]
    },
    "contentItem": {
      "type": "object",
      "description": "A content item that references a file by its key.",
      "properties": {
        "fileKey": {
          "type": "string",
          "description": "References the key of an item in the files collection."
        },
        "description": {
          "type": "string"
        }
      },
      "required": [
        "fileKey"
      ]
    },
    "singleSidedContentItem": {
      "allOf": [
        {
          "$ref": "#/$defs/contentItem"
        },
        {
          "not": {
            "properties": {
              "side": {
                "const": "back"
              }
            }
          }
        }
      ]
    },
    "twoSidedContentItem": {
      "allOf": [
        {
          "$ref": "#/$defs/contentItem"
        },
        {
          "required": [
            "side"
          ],
          "properties": {
            "side": {
              "type": "string",
              "enum": [
                "front",
                "back"
              ]
            }
          }
        }
      ]
    },
    "multipageContentItem": {
      "allOf": [
        {
          "$ref": "#/$defs/contentItem"
        },
        {
          "required": [
            "pages"
          ],
          "properties": {
            "pages": {
              "oneOf": [
                {
                  "type": "array",
                  "items": {
                    "type": "integer",
                    "minimum": 1
                  },
                  "minItems": 1
                },
                {
                  "type": "array",
                  "items": {
                    "oneOf": [
                      {
                        "type": "integer",
                        "minimum": 1
                      },
                      {
                        "type": "string",
                        "pattern": "^\\d+-\\d+$"
                      }
                    ]
                  },
                  "minItems": 1
                }
              ]
            }
          }
        }
      ]
    },
    "layout": {
      "type": "object",
      "properties": {
        "type": {
          "type": "string",
          "enum": [
            "single-sided",
            "two-sided",
            "multipage"
          ]
        },
        "content": {
          "type": "array",
          "minItems": 1
        }
      },
      "required": [
        "type",
        "content"
      ],
      "oneOf": [
        {
          "properties": {
            "type": {
              "const": "single-sided"
            },
            "content": {
              "items": {
                "$ref": "#/$defs/singleSidedContentItem"
              }
            }
          }
        },
        {
          "properties": {
            "type": {
              "const": "two-sided"
            },
            "content": {
              "items": {
                "$ref": "#/$defs/twoSidedContentItem"
              }
            }
          }
        },
        {
          "properties": {
            "type": {
              "const": "multipage"
            },
            "content": {
              "items": {
                "$ref": "#/$defs/multipageContentItem"
              }
            }
          }
        }
      ]
    }
  }
}